<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title  -->
    <title>Vertex</title>

    <!-- Favicon  -->
    <link rel="icon" href="/img/core-img/favicon.ico" />

    <!-- Core Style CSS -->
    <link rel="stylesheet" href="/css/core-style.css" />
</head>

<body>
    <!-- ##### Header Area Start ##### -->
    <%- include("./partials/navbar") %>

        <!-- ##### Header Area End ##### -->

        <!-- ##### Welcome Area Start ##### -->
        <section class="p-5 bg-img background-overlay">
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-12">
                        <div class="col-sm-10 col-md-8 col-lg-5 mx-auto d-table h-100">
                            <div class="d-table-cell align-middle">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="m-sm-4">
                                            <div class="text-center my-4">
                                                <h1 class="h2">Update Password</h1>
                                                <p class="">Your new password must be different from previous used
                                                    passwords.</p>
                                                <span id="validationMessage" class="text-danger mb-2"></span>
                                            </div>
                                            <form autocomplete="off">
                                                <div class="mb-3">
                                                    <label for="password" class="form-label">New Password</label>
                                                    <input autocomplete="false" id="password" class="form-control"
                                                        type="password" name="password"
                                                        placeholder="Enter your password" />
                                                    <span id="passwordValidationMessage"
                                                        class="text-danger mb-2"></span>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="confirmpassword" class="form-label">Confirm New
                                                        Password</label>
                                                    <input autocomplete="false" id="confirmpassword"
                                                        class="form-control" type="password" name="confirmpassword"
                                                        placeholder="Re-enter your password" />
                                                    <span id="confirmPasswordValidationMessage"
                                                        class="text-danger mb-2"></span>
                                                </div>

                                                <input type="hidden" name="email" id="hiddenemail"
                                                    value="<%= email %>" />
                                                <div class="text-center mb-2">
                                                    <button type="button" id="submitBtn" class="btn btn-primary">
                                                        Submit
                                                    </button>
                                                </div>
                                                <p>Don't have an account? <a class="sign-up-anchor"
                                                        href="/register">Sign
                                                        Up</a></p>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ##### Welcome Area End ##### -->

        <!-- ##### Footer Area Start ##### -->
        <%- include("./partials/user-footer") %>
            <!-- ##### Footer Area End ##### -->
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <!-- jQuery (Necessary for All JavaScript Plugins) -->
            <script src="/js/jquery/jquery-2.2.4.min.js"></script>
            <!-- Popper js -->
            <script src="/js/popper.min.js"></script>
            <!-- Bootstrap js -->
            <script src="/js/bootstrap.min.js"></script>
            <!-- Plugins js -->
            <script src="/js/plugins.js"></script>
            <!-- Classy Nav js -->
            <script src="/js/classy-nav.min.js"></script>
            <!-- Active js -->
            <script src="/js/active.js"></script>

            <script>


                const passwordValidationMessage = document.getElementById("passwordValidationMessage");
                const confirmPasswordValidationMessage = document.getElementById("confirmPasswordValidationMessage");
                const validationMessage = document.getElementById("validationMessage");


                const btn = document.getElementById("submitBtn");

                btn.addEventListener("click", async (event) => {
                    event.preventDefault();
                    console.log("button clicked");

                    const url = "/update-password";
                    const password = document.getElementById("password");
                    const confirmPassword = document.getElementById("confirmpassword");

                    passwordValidationMessage.textContent = "";
                    confirmPasswordValidationMessage.textContent = "";


                    if (password.value.trim() === "") {
                        passwordValidationMessage.textContent = "Password is required";
                        return;
                    }

                    if (confirmPassword.value.trim() == "") {
                        confirmPasswordValidationMessage.textContent = "Confirm Password is required";
                        return
                    } else if (password.value !== confirmPassword.value) {
                        confirmPasswordValidationMessage.textContent = "Passwords do not match";
                        return
                    }


                    try {
                        btn.disabled = true;
                        const email = document.getElementById("hiddenemail").value
                        const response = await fetch(url, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                email: email,
                                password: password.value,
                            }),
                        });
                        if (response.redirected) {

                            await Swal.fire("SweetAlert2 is working!");
                            window.location.href = response.url;
                        } else {
                            const jsonData = await response.json();
                            // Work with the parsed JSON data (jsonData) here
                            validationMessage.textContent = jsonData.message
                        }
                    } catch (error) {
                        console.log(error);
                    }
                });

            </script>
</body>

</html>

</html>